Feature: PECS Picture Discrimination Hierarchy Testing
  As a therapy professional implementing PECS
  I want comprehensive picture discrimination support
  So that I can systematically teach picture selection skills through Phases 3A and 3B

  Background:
    Given PECS picture discrimination system is configured
    And discrimination protocols are evidence-based
    And picture hierarchies are established
    And error correction procedures are standardized
    And correspondence checking is integrated

  # Phase 3A: Simple Discrimination Training
  @specialized @pecs @picture-discrimination @phase3a @critical @not-implemented
  Scenario: Implement Phase 3A simple discrimination training
    Given student has mastered Phase 2 travel and persistence
    And discrimination training is ready to begin
    When conducting Phase 3A discrimination training:
      | Discrimination Level | Preferred Item | Distractor Item | Trials | Correct Responses | Error Correction | Correspondence Check | Mastery Status |
      | Highly preferred vs neutral | Cookies | Sock | 10 | 10/10 | N/A | 100% match | Mastered |
      | Preferred vs non-preferred | Juice | Vegetables | 10 | 9/10 | 1 trial | 100% match | Mastered |
      | Two preferred items | iPad | Bubbles | 10 | 8/10 | 2 trials | 90% match | Emerging |
      | Similar preferred items | Crackers | Chips | 10 | 7/10 | 3 trials | 85% match | Practice needed |
      | Neutral items | Book | Paper | 10 | 6/10 | 4 trials | 80% match | More practice |
      | Abstract concepts | Play | Work | 10 | 5/10 | 5 trials | 70% match | Challenging |
    Then discrimination accuracy should improve systematically
    And error correction should be applied consistently
    And correspondence checks should confirm understanding
    And mastery criteria should be clearly defined

  @specialized @pecs @picture-discrimination @error-correction @critical @not-implemented
  Scenario: Apply systematic error correction procedures
    Given errors will occur during discrimination training
    And error correction must be systematic
    When implementing 4-step error correction:
      | Error Type | Student Choice | Step 1: Physical Prompt | Step 2: Verbal Prompt | Step 3: Return Item | Step 4: Retry | Success Rate | Learning Impact |
      | Wrong picture | Chose "apple" wanted "cookie" | Guide to correct picture | "Touch cookie" | Give back apple | Independent trial | 85% success | Quick correction |
      | No response | Student waited | Point to correct picture | "Touch what you want" | N/A | Second attempt | 80% success | Engagement maintained |
      | Multiple touches | Touched both pictures | Redirect to one choice | "Touch one picture" | Remove both briefly | Clear selection | 90% success | Clarity achieved |
      | Picture avoidance | Pushed pictures away | Replace with backup items | "Choose one" | Return original | Different setup | 75% success | Motivation restored |
      | Random selection | Grabbed without looking | Show picture-item match | "Look first" | Demonstrate correspondence | Guided choice | 70% success | Attention improved |
      | Prompt dependency | Waited for help | Delay physical prompt | Use expectant waiting | N/A | Independent attempt | 60% success | Independence building |
    Then error correction should be systematic and consistent
    And student learning should be facilitated
    And independence should be gradually increased
    And motivation should be maintained

  @specialized @pecs @picture-discrimination @correspondence-checking @high @not-implemented
  Scenario: Ensure correspondence between pictures and items
    Given picture-item correspondence is crucial for understanding
    And correspondence must be verified systematically
    When conducting correspondence checks:
      | Check Type | Picture Shown | Item Presented | Student Response | Correspondence Level | Assessment Result | Intervention Needed |
      | Direct match | Cookie picture | Actual cookie | Immediate reach | 100% correspondence | Perfect understanding | None |
      | Delayed match | Juice picture | Juice after 5 seconds | Patient waiting | 95% correspondence | Strong understanding | Monitor |
      | Distractor test | Apple picture | Apple + orange present | Chose apple only | 90% correspondence | Good understanding | Continue training |
      | Novel example | Car picture | Different toy car | Accepted substitute | 85% correspondence | Conceptual understanding | Expand examples |
      | Category test | Dog picture | Different breed dog | Recognized as dog | 80% correspondence | Category learning | Category training |
      | Abstract test | Happy picture | Smiling face | Showed understanding | 75% correspondence | Abstract emerging | More practice |
    Then correspondence understanding should be documented
    And conceptual learning should be assessed
    And picture-item relationships should be strong
    And generalization should be evaluated

  # Phase 3B: Multiple Picture Discrimination
  @specialized @pecs @picture-discrimination @phase3b @critical @not-implemented
  Scenario: Progress to Phase 3B multiple picture arrays
    Given student masters simple 2-picture discrimination
    And larger arrays are developmentally appropriate
    When implementing Phase 3B multiple picture training:
      | Array Size | Picture Categories | Organization Strategy | Scanning Pattern | Selection Accuracy | Error Types | Mastery Criteria |
      | 3 pictures | All food items | By preference ranking | Left to right | 85% | Rushed selection | 80% over 3 days |
      | 5 pictures | Mixed categories | By category groups | Systematic scan | 80% | Category confusion | 80% over 3 days |
      | 8 pictures | Various interests | By frequency of use | Organized search | 75% | Visual overwhelm | 75% over 5 days |
      | 12 pictures | Comprehensive vocabulary | Alphabetical order | Strategic selection | 70% | Position bias | 70% over 5 days |
      | 16 pictures | Full communication needs | Topic-based sections | Efficient navigation | 65% | Page turning issues | 65% over 1 week |
      | 20+ pictures | Complete vocabulary | Personal organization | Quick location | 60% | System complexity | 60% over 2 weeks |
    Then array size should increase systematically
    And organization should support efficiency
    And scanning skills should develop
    And selection accuracy should be maintained

  @specialized @pecs @picture-discrimination @visual-scanning @high @not-implemented
  Scenario: Develop systematic visual scanning skills
    Given effective scanning improves discrimination
    And scanning must be taught explicitly
    When training visual scanning skills:
      | Scanning Strategy | Teaching Method | Practice Structure | Student Response | Efficiency Measure | Error Reduction | Skill Development |
      | Left-to-right | Physical guidance | Row-by-row practice | Follows guidance | 3 seconds per item | 20% fewer errors | Systematic approach |
      | Top-to-bottom | Visual prompts | Column scanning | Independent scanning | 2 seconds per item | 30% fewer errors | Organized search |
      | Category search | Color coding | Group-based arrays | Recognizes patterns | 1.5 seconds per group | 40% fewer errors | Strategic thinking |
      | Frequency-based | Usage training | Most-used first | Prioritizes common items | 1 second for frequent | 50% fewer errors | Efficient selection |
      | Alphabetical | Letter recognition | ABC organization | Uses letter cues | 2 seconds with letters | 25% fewer errors | Academic integration |
      | Personal system | Individual preference | Custom organization | Creates own system | Variable by person | 35% fewer errors | Personalized efficiency |
    Then scanning should become systematic
    And efficiency should improve over time
    And error rates should decrease
    And independence should increase

  @specialized @pecs @picture-discrimination @organization-systems @medium @not-implemented
  Scenario: Implement effective picture organization systems
    Given organization affects discrimination success
    And systems must match student abilities
    When implementing organization systems:
      | Organization Type | Target Population | Layout Structure | Navigation Method | Maintenance Requirements | Success Indicators |
      | Preference-based | Early learners | Most-liked items first | Simple top-down | Weekly preference checks | Quick selection of favorites |
      | Category-based | Conceptual learners | Food, toys, activities | Section tabs | Monthly category review | Logical searching |
      | Frequency-based | Efficient communicators | Daily items prominent | Usage-driven layout | Ongoing usage tracking | Fast access to common items |
      | Alphabetical | Academic students | A-Z organization | Letter navigation | Periodic reorganization | Academic skill integration |
      | Topic-based | Advanced communicators | Situation-specific pages | Context navigation | Situation-based updates | Context-appropriate communication |
      | Personal-choice | Individual preferences | Student-designed system | Personalized method | Student-led maintenance | Ownership and efficiency |
    Then organization should match student needs
    And navigation should be intuitive
    And maintenance should be manageable
    And communication efficiency should improve

  # Advanced Discrimination Features
  @specialized @pecs @picture-discrimination @hierarchy-progression @high @not-implemented
  Scenario: Progress through discrimination hierarchy systematically
    Given discrimination complexity should increase gradually
    And progression must be data-driven
    When implementing hierarchy progression:
      | Hierarchy Level | Discrimination Task | Difficulty Factors | Success Criteria | Time Frame | Student Support | Next Level Readiness |
      | Level 1 | Preferred vs completely different | High contrast, clear preference | 90% accuracy | 3-5 days | Full prompting available | Consistent success |
      | Level 2 | Preferred vs less preferred | Moderate contrast | 85% accuracy | 5-7 days | Fading prompts | Stable performance |
      | Level 3 | Two preferred items | Both desirable | 80% accuracy | 1-2 weeks | Minimal prompting | Clear choice making |
      | Level 4 | Similar items within category | Visual similarity | 75% accuracy | 2-3 weeks | Independence focus | Careful discrimination |
      | Level 5 | Multiple array (3-5 items) | Increased options | 70% accuracy | 3-4 weeks | Scanning support | Array management |
      | Level 6 | Large array (6+ items) | Complex visual field | 65% accuracy | 4-6 weeks | Organization systems | Efficient navigation |
    Then progression should be individualized
    And success criteria should be appropriate
    And support should be systematic
    And readiness should be carefully assessed

  @specialized @pecs @picture-discrimination @generalization @critical @not-implemented
  Scenario: Generalize discrimination across materials and settings
    Given discrimination must work with various materials
    And generalization prevents over-dependence
    When implementing generalization training:
      | Generalization Type | Material Variation | Setting Variation | Partner Variation | Success Maintenance | Transfer Assessment |
      | Picture size | Wallet-size to poster-size | Same setting | Same partner | 85% accuracy maintained | Successful transfer |
      | Picture style | Photos to line drawings | Different rooms | Different people | 80% accuracy maintained | Good generalization |
      | Background color | Various colored cards | Home to school | Family to professionals | 75% accuracy maintained | Adequate transfer |
      | Array format | Different organization | Indoor to outdoor | Familiar to novel partners | 70% accuracy maintained | Emerging generalization |
      | Technology format | Paper to digital screens | Various locations | Mixed partner types | 65% accuracy maintained | Technology integration |
      | Communication book | Different book styles | All environments | All communication partners | 60% accuracy maintained | Complete generalization |
    Then generalization should be systematic
    And materials should be varied appropriately
    And settings should be diversified
    And partners should be multiple

  @specialized @pecs @picture-discrimination @problem-solving @medium @not-implemented
  Scenario: Address discrimination challenges and problem behaviors
    Given discrimination training may encounter challenges
    And problems must be addressed systematically
    When addressing discrimination challenges:
      | Challenge Type | Behavioral Manifestation | Underlying Cause | Intervention Strategy | Success Criteria | Prevention Plan |
      | Picture grabbing | Grabs multiple pictures | Impulse control | Teach "touch one" | Single selection | Hand positioning |
      | Avoidance behavior | Pushes pictures away | Task difficulty | Simplify array | Willing engagement | Appropriate level |
      | Position bias | Always chooses same spot | Habit pattern | Randomize positions | Location independence | Position rotation |
      | Prompt dependency | Waits for help | Learned helplessness | Delayed prompting | Independent attempts | Confidence building |
      | Motivation loss | Shows disinterest | Satiation/boredom | Refresh reinforcers | Renewed interest | Motivation monitoring |
      | Overwhelm behavior | Shuts down with arrays | Cognitive overload | Reduce complexity | Calm participation | Gradual building |
    Then challenges should be addressed proactively
    And interventions should be individualized
    And prevention should be prioritized
    And learning should continue

  # Data Collection and Assessment
  @specialized @pecs @picture-discrimination @data-tracking @critical @not-implemented
  Scenario: Track comprehensive discrimination data
    Given data drives discrimination training decisions
    And multiple variables must be monitored
    When collecting discrimination data:
      | Data Category | Specific Measures | Collection Method | Analysis Frequency | Decision Points | Intervention Adjustments |
      | Accuracy rates | Correct selections per session | Trial-by-trial recording | Daily review | <70% accuracy | Reduce array size |
      | Error patterns | Types and frequency of errors | Error categorization | Weekly analysis | Pattern identification | Targeted intervention |
      | Response time | Speed of picture selection | Stopwatch timing | Session summaries | >10 seconds average | Fluency training |
      | Scanning behavior | Visual search patterns | Observation notes | Bi-weekly review | Inefficient scanning | Scanning instruction |
      | Independence level | Prompting requirements | Prompt tracking | Daily monitoring | Increasing dependence | Prompt fading plan |
      | Generalization | Success across conditions | Multi-setting data | Monthly assessment | Limited transfer | Generalization training |
    Then data collection should be comprehensive
    And analysis should be systematic
    And decisions should be data-driven
    And adjustments should be timely

  @specialized @pecs @picture-discrimination @mastery-assessment @high @not-implemented
  Scenario: Assess discrimination mastery and readiness progression
    Given mastery must be clearly defined and assessed
    And progression decisions affect student success
    When assessing discrimination mastery:
      | Assessment Component | Measurement Criteria | Assessment Method | Mastery Standard | Reliability Check | Progression Decision |
      | Simple discrimination | 2-picture accuracy | Direct observation | 90% over 3 consecutive days | Inter-observer agreement | Ready for Phase 3B |
      | Error correction response | Learning from mistakes | Error-correction trials | 80% improvement in correction | Video review validation | Continue Phase 3A |
      | Correspondence understanding | Picture-item matching | Correspondence checks | 85% accurate matches | Multiple exemplar testing | Strong foundation |
      | Multiple array navigation | Large array success | Complex array trials | 70% accuracy with 8+ pictures | Systematic assessment | Ready for Phase 4 |
      | Scanning efficiency | Speed and accuracy | Timed assessments | <5 seconds with 75% accuracy | Repeated measures | Fluent discrimination |
      | Generalization stability | Cross-condition success | Multi-setting trials | 65% across 3+ conditions | Setting reliability | Robust skill |
    Then mastery should be thoroughly assessed
    And standards should be evidence-based
    And progression should be appropriate
    And skills should be stable

  # Error Handling and Troubleshooting
  @specialized @pecs @picture-discrimination @error @discrimination-breakdown @medium @not-implemented
  Scenario: Address discrimination skill breakdown
    Given discrimination skills may deteriorate
    When discrimination breakdown occurs:
      | Breakdown Type | Symptoms | Possible Causes | Assessment Strategy | Intervention Plan | Recovery Timeline |
      | Accuracy decline | Dropping below 60% | Fatigue, illness, environmental changes | Review recent sessions | Simplify demands, check health | 3-5 days |
      | Error increase | More mistakes than typical | New distractors, motivation loss | Error pattern analysis | Refresh training, check motivators | 1-2 weeks |
      | Scanning deterioration | Random picture selection | Overwhelm, regression | Observe scanning behavior | Re-teach scanning, reduce array | 1-3 weeks |
      | Prompt dependency return | Waiting for help again | Anxiety, over-assistance | Prompt level assessment | Systematic prompt fading | 2-4 weeks |
      | Generalization loss | Setting-specific success only | Limited practice, narrow training | Multi-setting assessment | Broad generalization training | 3-6 weeks |
      | Complete refusal | Won't engage with pictures | Negative associations, trauma | Comprehensive evaluation | Rebuild rapport, positive associations | Variable timeline |
    Then breakdown should be addressed immediately
    And causes should be systematically identified
    And interventions should be comprehensive
    And recovery should be monitored

  @specialized @pecs @picture-discrimination @error @materials-management @low @not-implemented
  Scenario: Manage picture materials and organization issues
    Given materials management affects discrimination success
    When material issues arise:
      | Material Issue | Impact on Learning | Management Strategy | Quality Control | Maintenance Schedule | Replacement Plan |
      | Picture wear/damage | Reduced clarity | Regular inspection | Weekly material check | Monthly replacement cycle | Backup copies ready |
      | Organization breakdown | Inefficient access | Systematic reorganization | Daily organization check | Weekly organization review | Simplified systems |
      | Missing pictures | Communication gaps | Inventory tracking | Nightly inventory | Immediate replacement | Digital backup access |
      | Size inconsistencies | Visual confusion | Standardize dimensions | Quarterly size audit | Size standardization | Uniform production |
      | Quality variations | Discrimination difficulty | Quality standards | Material quality review | Quality improvement | Professional printing |
      | Storage problems | Picture accessibility | Storage solutions | Access assessment | Storage optimization | Mobile organization |
    Then materials should be well-maintained
    And organization should be systematic
    And quality should be consistent
    And accessibility should be optimal

  @specialized @pecs @picture-discrimination @sustainability @high @not-implemented
  Scenario: Ensure sustainable discrimination training programs
    Given discrimination training must be maintainable long-term
    When planning for sustainability:
      | Sustainability Factor | Current Challenge | Sustainability Strategy | Resource Requirements | Success Indicators | Monitoring Plan |
      | Staff training | High turnover | Comprehensive training program | Training materials and time | Consistent implementation | Monthly competency checks |
      | Material maintenance | Ongoing replacement needs | Durable material systems | Quality materials budget | Materials last 6+ months | Quarterly material audits |
      | Program fidelity | Implementation drift | Fidelity monitoring systems | Monitoring tools and staff | 85% fidelity maintenance | Weekly fidelity checks |
      | Student progress | Variable outcomes | Data-driven adjustments | Assessment tools and analysis | 75% students show progress | Monthly progress reviews |
      | Family involvement | Limited home practice | Family training programs | Family education resources | Home implementation | Family check-ins |
      | Cost effectiveness | High program costs | Efficient program design | Streamlined procedures | Reduced cost per student | Cost analysis reviews |
    Then sustainability should be systematically planned
    And resources should be adequate
    And quality should be maintained
    And outcomes should be sustained